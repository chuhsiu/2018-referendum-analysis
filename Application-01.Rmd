---
title: "æ¢ç´¢ - å…¬æŠ•èˆ‡äººå£çµ±è¨ˆè³‡æ–™"
author: " <span style='font-size:70%;'>é„­ç«¹ç§€<span> "
output: 
  flexdashboard::flex_dashboard:
    social: menu
    source_code: embed 
    orientation: columns
runtime: shiny
---

```{r results='hide', message=FALSE, warning=FALSE, echo=F}
pacman::p_load(shiny,shinyWidgets,shinythemes,DT)
pacman::p_load(dplyr, stringr, ggplot2, plotly, GGally, FactoMineR,factoextra,heatmaply)

load("refData.rdata")

town = df_town[,-c(37:46)]
town$åŸä½æ°‘äººå£æ¯” = log(town$åŸä½æ°‘äººå£æ¯”)
s = names(town)[-c(1,2,27:36)]
r = names(town)[c(27:36)]
```


Sidebar {.sidebar data-width=280}
-------------------------------------
### Input
```{r}
# dropdown(
  selectInput(inputId="Op",NULL,
            s,c("äººå£å¯†åº¦","æ•™è‚²ç¨‹åº¦(ç¢©åš)","äººå‡æ”¶å…¥"),
            multiple=T)

  selectInput(inputId="Ref",NULL,r,c("ç¬¬ä¸ƒæ¡ˆ"),multiple=T)
  
  actionButton("go","é–‹å§‹")
  #   
  # style = "simple", icon = icon("bars"),
  # status = "primary", width = "320px")

df = eventReactive( input$go, {
    list(df_town=town, op=input$Op, ref=input$Ref)} )

```

Column {.tabset data-width=70%}
-------------------------------------
### ğŸŒ· æˆå°è®Šæ•¸çŸ©é™£

```{r}
renderPlotly({
  df_town = df()$df_town;op=df()$op;ref=df()$ref
highlight_key(df_town) %>% 
  ggpairs(
    columns = c(which(colnames(df_town) %in% op),which(colnames(df_town) %in% ref),1), mapping = aes(color=county,label=town),
    # lower = list(continuous=wrap("smooth",size=0.5,se=F)), 
    diag = list(continuous=wrap("densityDiag", alpha = 0.7, col='gray')) 
  ) %>% 
  ggplotly() %>% 
  highlight("plotly_selected")
})
```
